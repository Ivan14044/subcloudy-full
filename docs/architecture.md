# Архитектура проекта Subcloudy

## Обзор рефакторинга (Декабрь 2025)

Проект прошел через этап архитектурного рефакторинга для улучшения масштабируемости, читаемости и разделения ответственности. Основные изменения коснулись бэкенда (Laravel) и фронтенда (Vue 3).

### 1. Бэкенд (Laravel)

#### Пространство имен API
Все контроллеры, отвечающие за API запросы от фронтенда, перемещены в отдельное пространство имен `App\Http\Controllers\Api`. Это позволяет четко отделить логику API от административной панели и веб-маршрутов.

- **Путь:** `app/Http/Controllers/Api/`
- **Маршруты:** `routes/api.php`

#### Слой сервисов (Service Layer)
Сложная бизнес-логика вынесена из контроллеров в специализированные сервисные классы. Это делает контроллеры "тонкими" и облегчает тестирование.

- **`AuthService`**: Регистрация, обновление профиля, генерация токенов.
- **`SupportService`**: Управление тикетами поддержки, создание сообщений, интеграция с Telegram.
- **`EmailService`**: Централизованная отправка писем с поддержкой шаблонов и мультиязычности.
- **`NotifierService`**: Уведомления администраторов через внешние каналы.

#### Модели и отношения
Модели были очищены от лишней логики и дополнены правильными отношениями (Eloquent relationships) и приведениями типов (casts).

### 2. Фронтенд (Vue 3 + Pinia)

#### Переход на TypeScript
Критические части состояния приложения (Pinia stores) были переведены с JavaScript на TypeScript. Это обеспечивает:
- Строгую типизацию данных.
- Автодополнение в IDE.
- Снижение количества runtime-ошибок.

**Обновленные хранилища:**
- `src/stores/auth.ts`
- `src/stores/support.ts`
- `src/stores/cart.ts`
- `src/stores/notifications.ts`
- `src/stores/pages.ts`
- `src/stores/options.ts`

#### Оптимизация производительности
- **Lazy Loading**: Тяжелые компоненты главной страницы загружаются асинхронно через `defineAsyncComponent`.
- **GPU Acceleration**: Использование `will-change` и `transform3d` для плавных анимаций (стеклянный эффект, градиенты).
- **Image Optimization**: Атрибуты `loading="lazy"` и `decoding="async"` для всех изображений.
- **Vite Build**: Оптимизировано разделение на чанки (manual chunks) для уменьшения размера основного бандла.

### 3. Поддержка и Telegram
Система поддержки была полностью переработана:
- Поддержка гостевых сессий через `localStorage` и `guest_email`.
- Возможность отправки изображений.
- Синхронизация статусов в реальном времени (polling).
- Глубокая интеграция с Telegram-ботом через специальные ссылки с параметром `start`.

---

## Документация API

### Основные эндпоинты

- `GET /api/services` - Список активных сервисов.
- `GET /api/content/faq` - Часто задаваемые вопросы (поддерживает параметр `lang`).
- `GET /api/reviews` - Отзывы пользователей.
- `GET /api/savings-blocks` - Блоки экономии на главной.
- `POST /api/support/ticket` - Создание или получение тикета поддержки.
- `POST /api/support/ticket/{id}/messages` - Отправка сообщения (текст или фото).

---

## Установка и деплой

1. **Бэкенд:** `composer install`, `php artisan migrate`, `php artisan optimize`.
2. **Фронтенд:** `npm install`, `npm run build`.
3. **Хранилище:** `php artisan storage:link`.

