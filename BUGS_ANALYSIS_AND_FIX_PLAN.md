# Анализ багов сайта subcloudy.com и план исправления

## Найденные проблемы

### 1. КРИТИЧЕСКИЕ БАГИ

#### 1.1. Модальное окно поддержки не закрывается
**Описание:** Модальное окно поддержки не закрывается при клике на кнопку "Закрыть" или нажатии Escape на шаге выбора канала связи. Модальное окно блокирует взаимодействие с остальными элементами страницы.

**Причина:** В `SupportModal.vue` функция `handleClose()` блокирует закрытие на шагах 'channel' и 'email', что делает невозможным закрытие модального окна без выбора канала.

**Файл:** `ai-bot-front-main/src/components/SupportModal.vue` (строки 338-342)

**Решение:** 
- Разрешить закрытие модального окна через кнопку "Закрыть" на любом шаге
- Сохранить блокировку закрытия через клик по overlay только на шагах channel/email
- Добавить обработчик клавиши Escape для закрытия на любом шаге

#### 1.2. Ошибки в консоли (старая версия на сервере)
**Описание:** На сервере все еще работает старая версия с ошибками:
- `SupportButton: openSupportModal не предоставлен через provide`
- `TypeError: o.forEach is not a function` в ReviewSection
- `ERR_CONNECTION_REFUSED` для `127.0.0.1:7243` (отладочные логи)
- `404` для `logo-BkC0PaDI.webp`

**Причина:** Исправления были сделаны локально, но на сервере развернута старая версия.

**Решение:** Пересобрать проект и задеплоить обновленную версию на сервер.

### 2. КОНТЕНТНЫЕ БАГИ

#### 2.1. Дублирование текста в секции "Почему выбирают SubCloudy"
**Описание:** 
- **ru.json** (строка 177): "Быстрая активация" имеет текст: "Если доступ не надан в указанное время — мы вернем деньги." (скопирован из "Гарантия возврата")
- **ru.json** (строка 185): "Безопасные платежи" имеет текст: "Наша команда работает 24/7 — доступна на английском, украинском и русском." (скопирован из "24/7 поддержка")
- **es.json** (строка 185): "Pagos seguros" имеет текст: "Nuestro equipo está en línea 24/7 — disponible en inglés, ucraniano y ruso." (скопирован из "Soporte 24/7")

**Файлы:** 
- `ai-bot-front-main/src/i18n/locales/ru.json`
- `ai-bot-front-main/src/i18n/locales/es.json`

**Решение:** Исправить тексты в локализации:
- **ru.json** "Быстрая активация": "Автоматическая активация в течение нескольких минут после оплаты."
- **ru.json** "Безопасные платежи": "Ваши платежи обрабатываются безопасно с использованием стандартного шифрования."
- **es.json** "Pagos seguros": "Tus pagos se procesan de forma segura con cifrado estándar de la industria."

**Статус других языков:** 
- ✅ en.json - тексты правильные
- ✅ uk.json - тексты правильные  
- ❌ es.json - требуется исправление
- ✅ zh.json - тексты правильные

### 3. UX ПРОБЛЕМЫ

#### 3.1. Модальное окно блокирует взаимодействие с сайтом
**Описание:** Когда модальное окно поддержки открыто, пользователь не может взаимодействовать с остальными элементами страницы (кнопка "Войти", карточки сервисов и т.д.).

**Причина:** Overlay модального окна перехватывает все клики, а закрытие заблокировано на шаге выбора канала.

**Решение:** Исправить логику закрытия (см. пункт 1.1).

## План исправления

### Шаг 1: Исправить закрытие модального окна поддержки
**Файл:** `ai-bot-front-main/src/components/SupportModal.vue`

**Изменения:**
1. Модифицировать функцию `handleClose()` - убрать проверку на step для кнопки закрытия
2. Добавить параметр `forceClose` для принудительного закрытия через кнопку
3. Добавить обработчик клавиши Escape в `onMounted`
4. Сохранить блокировку закрытия через клик по overlay на шагах channel/email

**Код:**
```typescript
const handleClose = (forceClose = false) => {
    // Если закрытие принудительное (через кнопку) или на шаге chat - разрешаем
    if (forceClose || step.value === 'chat') {
        isVisible.value = false;
        step.value = 'channel';
        selectedChannel.value = null;
        email.value = '';
        messageText.value = '';
        channelLoading.value = null;
        supportStore.reset();
        return;
    }
    // Для клика по overlay - блокируем на channel/email
    if (step.value === 'channel' || step.value === 'email') {
        return;
    }
    // Обычное закрытие
    isVisible.value = false;
    // ... остальной код
};
```

### Шаг 2: Исправить тексты в локализации
**Файлы:** 
- `ai-bot-front-main/src/i18n/locales/ru.json`
- `ai-bot-front-main/src/i18n/locales/es.json`

**Изменения в ru.json:**
- Строка 177 (activation.description): `"Автоматическая активация в течение нескольких минут после оплаты."`
- Строка 185 (payment.description): `"Ваши платежи обрабатываются безопасно с использованием стандартного шифрования."`

**Изменения в es.json:**
- Строка 185 (payment.description): `"Tus pagos se procesan de forma segura con cifrado estándar de la industria."`

### Шаг 3: Пересобрать и задеплоить
1. Выполнить `npm run build` в `ai-bot-front-main`
2. Скопировать обновленные файлы на сервер через SSH/pscp
3. Проверить работоспособность после деплоя
4. Убедиться, что все ошибки в консоли исчезли

## Приоритет исправлений

1. **КРИТИЧЕСКИЙ:** Модальное окно не закрывается (блокирует весь сайт)
2. **ВЫСОКИЙ:** Пересборка и деплой исправлений (устраняет ошибки в консоли)
3. **СРЕДНИЙ:** Исправление дублирования текста (контентная ошибка, не критично для функционала)

## Дополнительные замечания

- Модальное окно поддержки открывается корректно через кнопку поддержки
- Выбор языка работает корректно
- Карточки сервисов отображаются правильно
- Отзывы загружаются, но есть ошибка forEach (исправлена локально, нужен деплой)

