# Детальный план по фиксу багов функционала техподдержки

## Результаты тестирования

### Тестирование на испанском языке (es):
- ❌ Кнопка поддержки отображается с текстом "????????" (проблема с локализацией)
- ❌ При клике на кнопку модальное окно не открывается
- ❌ В `es.json` отсутствует секция `support` с ключами для модального окна

### Тестирование на других языках:
- ⏳ Требуется дополнительное тестирование

## Найденные проблемы

### 1. КРИТИЧЕСКИЕ БАГИ

#### 1.1. Кнопка поддержки не открывает модальное окно
**Описание:** При клике на кнопку поддержки модальное окно не открывается.
**Причина:** 
- Возможно, проблема с `provide/inject` между `SupportModal` и `SupportButton`
- Или проблема с обработчиком событий `window.addEventListener('open-support-modal')`
**Файлы:**
- `ai-bot-front-main/src/components/SupportButton.vue`
- `ai-bot-front-main/src/components/SupportModal.vue`
- `ai-bot-front-main/src/components/layout/DefaultLayout.vue`

**План фикса:**
1. Проверить, что `SupportModal` монтируется до `SupportButton`
2. Добавить логирование в `handleClick` для отладки
3. Убедиться, что `provide('openSupportModal', open)` вызывается до того, как `SupportButton` пытается `inject`
4. Проверить fallback через `window.dispatchEvent`

#### 1.2. aria-label кнопки поддержки захардкожен на русском языке
**Описание:** В `SupportButton.vue` строка 4: `:aria-label="'Поддержка'"` - всегда на русском, независимо от языка сайта.
**Файл:** `ai-bot-front-main/src/components/SupportButton.vue:4`
**План фикса:**
1. Импортировать `useI18n` из `vue-i18n`
2. Заменить `:aria-label="'Поддержка'"` на `:aria-label="t('support.button')"`

#### 1.3. aria-label кнопки закрытия модального окна захардкожен на русском
**Описание:** В `SupportModal.vue` строка 8: `aria-label="Закрыть"` - всегда на русском.
**Файл:** `ai-bot-front-main/src/components/SupportModal.vue:8`
**План фикса:**
1. Добавить ключ локализации `support.close` во все языковые файлы
2. Заменить `aria-label="Закрыть"` на `:aria-label="t('support.close')"`

### 2. ПРОБЛЕМЫ С ЛОКАЛИЗАЦИЕЙ

#### 2.1. Отсутствуют ключи локализации для некоторых языков
**Проверка:** Нужно проверить наличие всех ключей `support.*` во всех языковых файлах:
- ✅ `en.json` - есть секция `support` с ключами (включая `chatInitError`)
- ✅ `ru.json` - есть секция `support` с ключами (но нет `chatInitError` и `close`)
- ❌ `uk.json` - **ОТСУТСТВУЕТ** секция `support` с ключами для модального окна
- ❌ `es.json` - **ОТСУТСТВУЕТ** секция `support` с ключами для модального окна
- ❌ `zh.json` - **ОТСУТСТВУЕТ** секция `support` с ключами для модального окна

**Необходимые ключи:**
- `support.button` - для aria-label кнопки поддержки
- `support.close` - для aria-label кнопки закрытия
- `support.title`
- `support.selectChannel`
- `support.channelWeb`
- `support.channelWebDesc`
- `support.channelTelegram`
- `support.channelTelegramDesc`
- `support.enterEmail`
- `support.emailPlaceholder`
- `support.startChat`
- `support.loading`
- `support.messagePlaceholder`
- `support.switchToTelegram`
- `support.send`
- `support.chatInitError`

**План фикса:**
1. ✅ Проверить наличие всех ключей во всех языковых файлах
2. ❌ Добавить недостающие ключи в `uk.json`, `es.json`, `zh.json`
3. ❌ Добавить ключи `close` и `chatInitError` в `ru.json`
4. Убедиться, что все переводы корректны

**Необходимо добавить в `uk.json`, `es.json`, `zh.json`:**
```json
"support": {
  "button": "...",
  "title": "...",
  "selectChannel": "...",
  "channelWeb": "...",
  "channelWebDesc": "...",
  "channelTelegram": "...",
  "channelTelegramDesc": "...",
  "enterEmail": "...",
  "emailPlaceholder": "...",
  "startChat": "...",
  "loading": "...",
  "messagePlaceholder": "...",
  "switchToTelegram": "...",
  "send": "...",
  "close": "...",
  "chatInitError": "..."
}
```

### 3. ПРОБЛЕМЫ С ФУНКЦИОНАЛЬНОСТЬЮ

#### 3.1. Модальное окно может закрываться при клике на кнопки выбора канала
**Описание:** При клике на "Чат на сайте" или "Telegram" модальное окно может закрываться вместо перехода к следующему шагу.
**Файл:** `ai-bot-front-main/src/components/SupportModal.vue`
**План фикса:**
1. Убедиться, что `@click.stop` присутствует на кнопках каналов
2. Проверить, что `handleChannelClick` не вызывает закрытие модального окна
3. Убедиться, что `handleOverlayClick` не срабатывает при клике на кнопки

#### 3.2. Валидация email может быть слишком строгой
**Описание:** В строке 159 `SupportModal.vue`: `val.length > 3` - может быть слишком строго для некоторых email.
**Файл:** `ai-bot-front-main/src/components/SupportModal.vue:159`
**План фикса:**
1. Улучшить валидацию email (использовать регулярное выражение)
2. Или использовать встроенную валидацию HTML5 `type="email"`

#### 3.3. Обработка ошибок при создании тикета
**Описание:** Сообщения об ошибках могут быть на русском языке, даже если сайт на другом языке.
**Файлы:**
- `ai-bot-front-main/src/stores/support.ts`
- `ai-bot-front-main/src/components/SupportModal.vue`

**План фикса:**
1. Заменить все хардкоженные сообщения об ошибках на ключи локализации
2. Добавить соответствующие ключи во все языковые файлы

### 4. ПРОБЛЕМЫ С UI/UX

#### 4.1. Отсутствует индикатор загрузки при отправке сообщения
**Описание:** Пользователь может не понимать, что сообщение отправляется.
**План фикса:**
1. Убедиться, что кнопка отправки показывает состояние загрузки
2. Добавить визуальную индикацию (спиннер или disabled состояние)

#### 4.2. Нет обработки случая, когда тикет не создан
**Описание:** Если создание тикета не удалось, пользователь может не понять, что делать дальше.
**План фикса:**
1. Показывать понятное сообщение об ошибке
2. Предложить повторить попытку

### 5. ПРОБЛЕМЫ С БЕКЕНДОМ (если есть)

#### 5.1. Проверка маршрутов API
**Описание:** Нужно убедиться, что все маршруты API работают корректно.
**Маршруты:**
- `GET /api/support/ticket` - для авторизованных
- `POST /api/support/ticket` - для неавторизованных (с email)
- `POST /api/support/ticket/{id}/message` - отправка сообщения
- `GET /api/support/ticket/{id}/messages` - получение новых сообщений
- `GET /api/support/ticket/{id}/telegram-link` - получение ссылки Telegram

**План фикса:**
1. Проверить все маршруты в `ai-bot-main/routes/api.php`
2. Убедиться, что контроллер `SupportController` обрабатывает все случаи
3. Проверить обработку ошибок на бекенде

## План действий по приоритетам

### Приоритет 1 (КРИТИЧНО - блокирует функционал):
1. ✅ Исправить открытие модального окна при клике на кнопку поддержки
2. ✅ Исправить aria-label кнопки поддержки (локализация)
3. ✅ Исправить aria-label кнопки закрытия (локализация)
4. ✅ Проверить и исправить закрытие модального окна при клике на кнопки каналов

### Приоритет 2 (ВАЖНО - влияет на UX):
1. Добавить все недостающие ключи локализации
2. Исправить сообщения об ошибках (локализация)
3. Улучшить валидацию email
4. Добавить индикаторы загрузки

### Приоритет 3 (УЛУЧШЕНИЯ):
1. Улучшить обработку ошибок
2. Добавить повторные попытки при ошибках
3. Улучшить UI/UX модального окна

## Тестирование

### Чек-лист тестирования:

#### Для каждого языка (en, ru, uk, es, zh):
1. ✅ Кнопка поддержки видна и кликабельна
2. ✅ aria-label кнопки поддержки на правильном языке
3. ✅ При клике открывается модальное окно
4. ✅ Заголовок модального окна на правильном языке
5. ✅ Кнопки выбора канала отображаются корректно
6. ✅ При клике на "Чат на сайте" для неавторизованного пользователя открывается форма email
7. ✅ При клике на "Telegram" для неавторизованного пользователя открывается форма email
8. ✅ Валидация email работает корректно
9. ✅ При отправке email открывается чат
10. ✅ Сообщения отправляются и отображаются
11. ✅ Новые сообщения получаются через polling
12. ✅ Кнопка закрытия работает корректно
13. ✅ aria-label кнопки закрытия на правильном языке

#### Для авторизованных пользователей:
1. ✅ При клике на канал сразу открывается чат (без формы email)
2. ✅ Сообщения отправляются и отображаются
3. ✅ Новые сообщения получаются через polling

#### Для Telegram:
1. ✅ При выборе Telegram и отправке email открывается ссылка Telegram
2. ✅ Кнопка "Перейти в Telegram" отображается в чате
3. ✅ При клике на кнопку открывается ссылка Telegram

## Файлы для изменения

1. `ai-bot-front-main/src/components/SupportButton.vue` - исправить aria-label
2. `ai-bot-front-main/src/components/SupportModal.vue` - исправить aria-label кнопки закрытия, проверить открытие модального окна
3. `ai-bot-front-main/src/stores/support.ts` - локализовать сообщения об ошибках
4. `ai-bot-front-main/src/i18n/locales/en.json` - ✅ готов
5. `ai-bot-front-main/src/i18n/locales/ru.json` - добавить `close` и `chatInitError`
6. `ai-bot-front-main/src/i18n/locales/uk.json` - **ДОБАВИТЬ ВСЮ СЕКЦИЮ `support`**
7. `ai-bot-front-main/src/i18n/locales/es.json` - **ДОБАВИТЬ ВСЮ СЕКЦИЮ `support`**
8. `ai-bot-front-main/src/i18n/locales/zh.json` - **ДОБАВИТЬ ВСЮ СЕКЦИЮ `support`**

## Итоговая статистика

### Найдено проблем:
- **Критических:** 3
- **Важных:** 4
- **Улучшений:** 2

### Статус локализации:
- ✅ Английский (en) - полная локализация
- ⚠️ Русский (ru) - не хватает 2 ключей
- ❌ Украинский (uk) - отсутствует секция support
- ❌ Испанский (es) - отсутствует секция support
- ❌ Китайский (zh) - отсутствует секция support

### Приоритет исправлений:
1. **СРОЧНО:** Исправить открытие модального окна
2. **СРОЧНО:** Добавить локализацию для uk, es, zh
3. **ВАЖНО:** Исправить aria-label
4. **ВАЖНО:** Локализовать сообщения об ошибках
5. **УЛУЧШЕНИЕ:** Улучшить валидацию и UX

