# Инструкция по настройке SMTP

## Введение

Эта инструкция поможет вам настроить SMTP для отправки писем из системы Subcloudy. Настройки SMTP находятся в админ-панели в разделе **Настройки → SMTP**.

## Доступ к настройкам

1. Войдите в админ-панель
2. Перейдите в раздел **Настройки**
3. Откройте вкладку **SMTP**

## Поля настроек

### Адрес отправителя (from_address)
- **Описание**: Email адрес, с которого будут отправляться все письма
- **Пример**: `noreply@subcloudy.com`
- **Важно**: Этот адрес должен быть валидным email адресом

### Имя отправителя (from_name)
- **Описание**: Имя, которое будет отображаться в поле "От" в письмах
- **Пример**: `Subcloudy` или `Команда Subcloudy`
- **Важно**: Это имя будет видно получателям писем

### SMTP Хост (host)
- **Описание**: Адрес SMTP сервера вашего почтового провайдера
- **Примеры**:
  - Gmail: `smtp.gmail.com`
  - Mail.ru: `smtp.mail.ru`
  - Yandex: `smtp.yandex.ru`
  - Outlook: `smtp-mail.outlook.com`

### Порт (port)
- **Описание**: Порт для подключения к SMTP серверу
- **Стандартные порты**:
  - **587** - TLS (рекомендуется для большинства сервисов)
  - **465** - SSL
  - **25** - Без шифрования (не рекомендуется)

### Шифрование (encryption)
- **Описание**: Тип шифрования соединения
- **Варианты**:
  - **TLS** - Рекомендуется для большинства SMTP серверов (обычно используется с портом 587)
  - **SSL** - Используется с портом 465
  - **Без шифрования** - Не рекомендуется из соображений безопасности

### Имя пользователя (username)
- **Описание**: Обычно это ваш email адрес для входа в почтовый сервис
- **Пример**: `user@example.com`
- **Важно**: Для некоторых сервисов может отличаться от email адреса

### Пароль (password)
- **Описание**: Пароль для SMTP авторизации
- **Важно**: 
  - Для Gmail необходимо использовать **"Пароль приложения"**, а не обычный пароль
  - Пароль скрыт при вводе для безопасности
  - Можно показать/скрыть пароль с помощью кнопки с иконкой глаза

## Настройка для популярных почтовых сервисов

### Gmail

1. **Включите двухфакторную аутентификацию** в настройках Google аккаунта
2. **Создайте пароль приложения**:
   - Перейдите в [Настройки аккаунта Google](https://myaccount.google.com/)
   - Безопасность → Двухэтапная аутентификация → Пароли приложений
   - Создайте новый пароль приложения для "Почта"
   - Используйте этот пароль в поле "Пароль"
3. **Настройки SMTP**:
   - Хост: `smtp.gmail.com`
   - Порт: `587`
   - Шифрование: `TLS`
   - Имя пользователя: ваш Gmail адрес (например, `user@gmail.com`)
   - Пароль: пароль приложения (16 символов)

### Mail.ru

1. **Настройки SMTP**:
   - Хост: `smtp.mail.ru`
   - Порт: `465`
   - Шифрование: `SSL`
   - Имя пользователя: ваш email на Mail.ru
   - Пароль: ваш пароль от почтового ящика

2. **Важно**: Убедитесь, что в настройках почты Mail.ru включен доступ по протоколу SMTP

### Yandex

1. **Настройки SMTP**:
   - Хост: `smtp.yandex.ru`
   - Порт: `465`
   - Шифрование: `SSL`
   - Имя пользователя: ваш email на Yandex
   - Пароль: ваш пароль от почтового ящика

2. **Альтернативный вариант**:
   - Порт: `587`
   - Шифрование: `TLS`

### Outlook/Hotmail

1. **Настройки SMTP**:
   - Хост: `smtp-mail.outlook.com`
   - Порт: `587`
   - Шифрование: `TLS`
   - Имя пользователя: ваш email на Outlook
   - Пароль: ваш пароль от почтового ящика

## Тестирование подключения

После заполнения всех полей:

1. Нажмите кнопку **"Тестировать подключение"**
2. Дождитесь результата тестирования
3. Если тест успешен:
   - Вы получите тестовое письмо на указанный адрес отправителя
   - В письме будет информация о настройках SMTP
   - Нажмите **"Сохранить"** для сохранения настроек
4. Если тест не прошел:
   - Проверьте правильность всех введенных данных
   - Убедитесь, что сервер доступен
   - Проверьте, что пароль правильный
   - Для Gmail убедитесь, что используете пароль приложения

## Решение типичных проблем

### Ошибка: "Connection timed out"
- **Причина**: Не удалось подключиться к SMTP серверу
- **Решение**:
  - Проверьте правильность хоста
  - Убедитесь, что порт правильный
  - Проверьте доступность сервера (может быть заблокирован файрволом)

### Ошибка: "Authentication failed"
- **Причина**: Неправильные учетные данные
- **Решение**:
  - Проверьте правильность имени пользователя и пароля
  - Для Gmail используйте пароль приложения, а не обычный пароль
  - Убедитесь, что в настройках почтового сервиса разрешен доступ по SMTP

### Ошибка: "Could not connect to host"
- **Причина**: Неправильный адрес SMTP сервера
- **Решение**:
  - Проверьте правильность хоста
  - Убедитесь, что используете правильный SMTP адрес для вашего почтового провайдера

### Письма не доставляются
- **Проверьте логи**: Все ошибки отправки логируются в `storage/logs/mail.log`
- **Проверьте спам**: Письма могут попадать в папку "Спам"
- **Проверьте настройки**: Убедитесь, что все поля заполнены правильно

## Безопасность

1. **Пароль**: Никогда не делитесь паролем SMTP с третьими лицами
2. **Пароль приложения**: Для Gmail всегда используйте пароль приложения, а не основной пароль
3. **Шифрование**: Рекомендуется использовать TLS или SSL для защиты данных
4. **Регулярная проверка**: Периодически проверяйте логи на наличие ошибок

## Логирование

Все отправки писем логируются в отдельный файл:
- **Путь**: `storage/logs/mail.log`
- **Содержимое**: Успешные и неуспешные попытки отправки с детальной информацией
- **Ротация**: Логи хранятся 30 дней, затем автоматически удаляются

## Кэширование

Настройки SMTP кэшируются для повышения производительности:
- Кэш автоматически очищается при изменении настроек
- Время жизни кэша: 24 часа
- При необходимости можно очистить кэш вручную через админ-панель

## Поддержка

Если у вас возникли проблемы с настройкой SMTP:
1. Проверьте логи в `storage/logs/mail.log`
2. Убедитесь, что все поля заполнены правильно
3. Попробуйте протестировать подключение еще раз
4. Обратитесь к документации вашего почтового провайдера

## Дополнительная информация

- Настройки применяются сразу после сохранения
- Тестовое письмо отправляется на адрес, указанный в поле "Адрес отправителя"
- Все письма отправляются от имени, указанного в поле "Имя отправителя"
- Система автоматически использует язык пользователя для отправки писем

