import{u as e,a as t,c as s,e as i,_ as n}from"./index-Dh_YmDWd.js";import{u as a}from"./alert-D7KfH9V3.js";import{d as o,r,o as c,c as u,w as l,l as d,m as p,n as g,t as h,x as v,v as f,F as b,G as m,q as y}from"./vendor-vue-hI7Tl2YZ.js";import{u as x}from"./vendor-i18n-DgmEITMB.js";import"./vendor-ui-C1W_zwwL.js";const S={class:"w-full lg:w-1/2 mx-auto min-h-[calc(100vh-388px)] px-4 py-16 sm:px-6 lg:px-8"},_={class:"text-center mb-6"},w={class:"text-4xl font-light text-gray-900 dark:text-white mt-3"},I={class:"flex justify-center mt-6 space-x-4"},T={key:0,class:"space-y-6"},k={class:"d-flex align-center gap-3 flex-wrap service-item"},P={class:"flex-1 min-w-[200px]"},O={class:"flex justify-between items-start"},C=["textContent"],j=["textContent"],L=["innerHTML"],D={class:"text-[12px] dark:!text-gray-400"},$={class:"text-[12px] dark:!text-gray-400"},N={key:0,class:"text-[12px] dark:!text-gray-400"},J=["innerHTML"],F=["src","alt"],G={key:0,class:"flex gap-2 mt-2 items-stretch h-8"},U={class:"inline-block w-full h-full text-xs font-medium px-2 py-1 rounded-lg text-center flex items-center justify-center bg-green-400 text-gray-800"},M={key:0,class:"w-1/2"},H=["onClick"],A={key:1,class:"text-center text-gray-500 dark:text-gray-300"},B=n(o({__name:"SubscriptionsPage",setup(n){const o=e(),B=t(),{locale:q,t:K}=x(),{showConfirm:R}=a(),Y=r("active"),z=s(),E=i();function Q(e){var t,s,i;const n=z.services.find(t=>t.id===e),a=(null==(s=null==(t=null==n?void 0:n.translations)?void 0:t[q.value])?void 0:s.name)??`#${e}`;return fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SubscriptionsPage.vue:getServiceName",message:"Getting service name",data:{serviceId:e,hasService:!!n,servicesLength:(null==(i=z.services)?void 0:i.length)||0,result:a},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{}),a}function V(e){var t,s;const i=z.services.find(t=>t.id===e),n=(null==(s=null==(t=null==i?void 0:i.translations)?void 0:t[q.value])?void 0:s.subtitle)??null;return fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SubscriptionsPage.vue:getServiceSubtitle",message:"Getting service subtitle",data:{serviceId:e,hasService:!!i,result:n},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{}),n}function W(e){const t=z.services.find(t=>t.id===e),s=(null==t?void 0:t.logo)??"";return fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SubscriptionsPage.vue:getServiceLogo",message:"Getting service logo",data:{serviceId:e,hasService:!!t,result:s},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{}),s}function X(e){const t=z.services.find(t=>t.id===e),s=(null==t?void 0:t.amount.toFixed(2))??"";return fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SubscriptionsPage.vue:getServiceAmount",message:"Getting service amount",data:{serviceId:e,hasService:!!t,result:s},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(()=>{}),s}c(()=>{var e,t,s,i,n,a,r,c;const u={location:"SubscriptionsPage.vue:onMounted",message:"SubscriptionsPage mounted",data:{hasUser:!!o.user,hasSubscriptions:!!(null==(e=o.user)?void 0:e.subscriptions),subscriptionsLength:(null==(s=null==(t=o.user)?void 0:t.subscriptions)?void 0:s.length)||0,subscriptions:(null==(i=o.user)?void 0:i.subscriptions)||[],userKeys:o.user?Object.keys(o.user):[],hasServices:!!z.services,servicesLength:(null==(n=z.services)?void 0:n.length)||0,filteredSubscriptionsLength:Z.value.length,filteredSubscriptions:Z.value},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"A"};fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).catch(()=>{}),(null==(r=null==(a=o.user)?void 0:a.subscriptions)?void 0:r.length)||(fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SubscriptionsPage.vue:onMounted",message:"No subscriptions found, fetching user",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"})}).catch(()=>{}),o.fetchUser().then(()=>{var e,t,s,i;const n={location:"SubscriptionsPage.vue:afterFetchUser",message:"User fetched after mount",data:{hasSubscriptions:!!(null==(e=o.user)?void 0:e.subscriptions),subscriptionsLength:(null==(s=null==(t=o.user)?void 0:t.subscriptions)?void 0:s.length)||0,subscriptions:(null==(i=o.user)?void 0:i.subscriptions)||[],filteredSubscriptionsLength:Z.value.length},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"B"};fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(()=>{})})),(null==(c=z.services)?void 0:c.length)||(fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SubscriptionsPage.vue:onMounted",message:"No services found, fetching services",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(()=>{}),z.fetchData().then(()=>{var e;const t={location:"SubscriptionsPage.vue:afterFetchServices",message:"Services fetched after mount",data:{servicesLength:(null==(e=z.services)?void 0:e.length)||0,services:z.services||[]},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"};fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(()=>{})}))}),l(()=>{var e;return null==(e=o.user)?void 0:e.subscriptions},(e,t)=>{const s={location:"SubscriptionsPage.vue:watch",message:"Subscriptions changed",data:{oldLength:(null==t?void 0:t.length)||0,newLength:(null==e?void 0:e.length)||0,newSubscriptions:e||[]},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"C"};fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).catch(()=>{})},{deep:!0});const Z=u(()=>{var e,t,s,i,n,a;const r={location:"SubscriptionsPage.vue:filteredSubscriptions",message:"Computing filtered subscriptions",data:{hasUser:!!o.user,hasSubscriptions:!!(null==(e=o.user)?void 0:e.subscriptions),subscriptionsLength:(null==(s=null==(t=o.user)?void 0:t.subscriptions)?void 0:s.length)||0,activeTab:Y.value,allSubscriptions:(null==(i=o.user)?void 0:i.subscriptions)||[]},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"D"};if(fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch(()=>{}),!(null==(a=null==(n=o.user)?void 0:n.subscriptions)?void 0:a.length))return[];const c=o.user.subscriptions.filter(e=>"active"===Y.value?"active"===e.status:"active"!==e.status),u={location:"SubscriptionsPage.vue:filteredSubscriptions",message:"Filtered subscriptions result",data:{filteredLength:c.length,filtered:c},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"D"};return fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).catch(()=>{}),c});l(()=>q.value,(e,t)=>{var s,i,n,a;const r={location:"SubscriptionsPage.vue:watch:locale",message:"Locale changed",data:{oldLocale:t,newLocale:e,hasUser:!!o.user,hasSubscriptions:!!(null==(s=o.user)?void 0:s.subscriptions),subscriptionsLength:(null==(n=null==(i=o.user)?void 0:i.subscriptions)?void 0:n.length)||0,filteredSubscriptionsLength:Z.value.length,hasServices:!!z.services,servicesLength:(null==(a=z.services)?void 0:a.length)||0},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"H"};fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch(()=>{})}),l(()=>Z.value,(e,t)=>{const s={location:"SubscriptionsPage.vue:watch:filteredSubscriptions",message:"Filtered subscriptions changed",data:{oldLength:(null==t?void 0:t.length)||0,newLength:(null==e?void 0:e.length)||0,newFiltered:e||[],currentLocale:q.value},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"I"};fetch("http://127.0.0.1:7243/ingest/2d4847af-9357-42a3-b2e4-f6ffc47c0ee5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).catch(()=>{})},{deep:!0});const ee=function(e){const t=new Date(e);return`${String(t.getDate()).padStart(2,"0")}.${String(t.getMonth()+1).padStart(2,"0")}.${t.getFullYear()}`};return(e,t)=>(p(),d("div",S,[g("div",_,[g("h1",w,v(e.$t("subscriptions.title")),1),g("div",I,[g("button",{class:f(["px-4 py-2 rounded-lg font-medium","active"===Y.value?"bg-blue-500 dark:bg-blue-900 text-white cursor-default":"bg-gray-300 dark:bg-gray-400 dark:text-gray-800 text-gray-800 hover:!bg-gray-200"]),onClick:t[0]||(t[0]=e=>Y.value="active")},v(e.$t("subscriptions.active_tab")),3),g("button",{class:f(["px-4 py-2 rounded-lg font-medium","inactive"===Y.value?"bg-blue-500 dark:bg-blue-900 text-white cursor-default":"bg-gray-300 dark:bg-gray-400 dark:text-gray-800 text-gray-800 hover:!bg-gray-200"]),onClick:t[1]||(t[1]=e=>Y.value="inactive")},v(e.$t("subscriptions.inactive_tab")),3)])]),Z.value.length?(p(),d("div",T,[(p(!0),d(b,null,m(Z.value,t=>{var s;return p(),d("div",{key:t.id,class:"space-y-2 mb-2"},[g("div",k,[g("div",P,[g("div",O,[g("div",null,[g("h3",{class:f(["text-xl font-medium text-gray-900 dark:!text-white",{"mb-1":null===V(t.service_id)}]),textContent:v(e.$t("subscriptions.title_sub",{name:Q(t.service_id)}))},null,10,C),V(t.service_id)?(p(),d("h4",{key:0,class:"text-sm text-gray-600 dark:!text-gray-300 font-medium mb-1 mt-0 lh-1",textContent:v(V(t.service_id))},null,8,j)):h("",!0),g("p",{class:"text-sm text-gray-900 dark:!text-gray-400 leading-relaxed",innerHTML:e.$t("plans.price_monthly",{price:X(t.service_id),currency:((null==(s=y(E).options)?void 0:s.currency)||"USD").toUpperCase()})},null,8,L),g("p",D,v(e.$t("subscriptions.payment_method",{method:e.$t("checkout."+t.payment_method)})),1),g("p",$,v(e.$t("subscriptions.created_at",{date:ee(t.created_at)})),1),"credit_card"===t.payment_method&&"active"===t.status?(p(),d(b,{key:1},[t.is_auto_renew?(p(),d("p",N,v(e.$t("subscriptions.next_payment_at",{date:ee(t.next_payment_at)})),1)):(p(),d("p",{key:1,class:"text-[12px] dark:!text-gray-400",innerHTML:e.$t("subscriptions.end_at",{date:ee(t.next_payment_at)})},null,8,J))],64)):h("",!0)]),g("img",{src:W(t.service_id),alt:Q(t.service_id),class:"w-[100px] h-[100px] object-contain object-center service-logo"},null,8,F)]),"active"===t.status?(p(),d("div",G,[g("div",{class:f(["active"!==t.status||"credit_card"!==t.payment_method?"w-full":"w-1/2"])},[g("span",U,v(e.$t("subscriptions.status_"+t.status)),1)],2),"active"===t.status&&"credit_card"===t.payment_method?(p(),d("div",M,[g("button",{type:"button",class:"w-full h-full bg-black text-white rounded-lg hover:bg-gray-800 text-sm",onClick:e=>async function(e,t){const s=1===t;if((await R({title:K(s?"subscriptions.toggle_confirm_title_cancel":"subscriptions.toggle_confirm_title_renew"),text:K(s?"subscriptions.toggle_confirm_text_cancel":"subscriptions.toggle_confirm_text_renew"),confirmText:K("subscriptions.toggle_confirm_yes"),cancelText:K("subscriptions.toggle_confirm_no")})).isConfirmed)try{await o.toggleAutoRenew(e),await o.fetchUser(),B.success(K("subscriptions.toggled_success"))}catch(i){B.error(K("subscriptions.toggled_error"))}}(t.id,t.is_auto_renew)},v(t.is_auto_renew?e.$t("subscriptions.cancel"):e.$t("subscriptions.renew")),9,H)])):h("",!0)])):h("",!0)])])])}),128))])):h("",!0),Z.value.length?h("",!0):(p(),d("p",A,v("active"===Y.value?e.$t("subscriptions.empty_active"):e.$t("subscriptions.empty_inactive")),1))]))}}),[["__scopeId","data-v-145ef975"]]);export{B as default};
