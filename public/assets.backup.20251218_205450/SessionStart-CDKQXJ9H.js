import{k as t,d as i,r as e,E as s,o as n,j as l,l as a,m as o,t as r}from"./vendor-vue-hI7Tl2YZ.js";import{g as u,u as d,c as p,h as c}from"./index-CGk_Y9gA.js";import"./vendor-i18n-DgmEITMB.js";import"./vendor-ui-C1W_zwwL.js";const h=t("browserSessions",{state:()=>({url:null,pid:null,port:null}),actions:{async startSession(t,i,e){var s,n;try{const l=(null==(n=null==(s=d().user)?void 0:s.extension_settings)?void 0:n.uiLanguage)||"en",a=await u.get("/browser/new",{params:{service_id:t??void 0,uiLanguage:l,...void 0!==i&&{width:i},...void 0!==e&&{height:e}}}),{pid:o,port:r,url:p}=a.data;return this.pid=o,this.port=r,this.url=p,{pid:o,port:r,url:p}}catch(l){return null}},async stopSession(t){const i="number"==typeof t?t:this.pid;if(i)try{await u.post("/browser/stop",{pid:i}),this.pid===i&&(this.pid=null,this.port=null,this.url=null)}catch(e){}},async stopSessionByPort(t){const i="number"==typeof t?t:this.port;if(i)try{await u.post("/browser/stop",{port:i}),this.port===i&&(this.pid=null,this.port=null,this.url=null)}catch(e){}},async stopAllSessions(t=!1){try{await u.post("/browser/stop_all",t?{clean:!0}:{}),this.pid=null,this.port=null,this.url=null}catch(i){}},async listSessions(){try{return(await u.get("/browser/list")).data}catch(t){return null}}}}),v={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},w={class:"fixed inset-0"},m=["src"],g=i({__name:"SessionStart",setup(t){const i=e(null),u=e(!1),g=e(!1),y=s(),f=h(),S=d(),b=p(),{checkPluginInstalled:E}=c();let _=null,x=null;n(async()=>{const t=(()=>{const t=y.params.id,i=t?Number(t):NaN;return Number.isFinite(i)?i:null})();await b.fetchData();(await E()).isInstalled?(u.value=!0,k(t)):(x=i=>{const{pluginInstalled:e,pluginSkipped:s}=i.detail||{};(e||s)&&(u.value=!0,k(t))},window.addEventListener("app:plugin-status",x),window.dispatchEvent(new CustomEvent("app:check-plugin-status")))});const k=async t=>{if(u.value&&!g.value&&!i.value)try{g.value=!0;const e={width:window.innerWidth,height:window.innerHeight},s=Math.max(360,Math.min(2560,e.width)),n=Math.max(600,Math.min(1440,e.height)),l=await f.startSession(t,s,n);if(!l)return void(g.value=!1);i.value=l.url,_=window.setTimeout(()=>{window.dispatchEvent(new CustomEvent("app:hide-loader"));const i=t?b.getById(t):void 0,e=null==i?void 0:i.params;if((null==e?void 0:e.title)&&"string"==typeof e.title&&e.title.length>0&&(document.title=e.title),(null==e?void 0:e.icon)&&"string"==typeof e.icon&&e.icon.length>0){const t=e.icon,i=/^https?:\/\//i.test(t)?t:`${(null==v?void 0:v.VITE_APP_DOMAIN)||""}${t}`,s=i.endsWith(".ico")?"image/x-icon":"image/png";((t,i)=>{let e=document.querySelector("link[rel='icon']");e||(e=document.createElement("link"),e.rel="icon",document.head.appendChild(e)),e.type=i,e.href=t})(i,s)}},5250),S.update({browser_session_pid:l.pid}).catch(t=>{})}catch(e){g.value=!1}};return l(()=>{null!==_&&(clearTimeout(_),_=null),x&&(window.removeEventListener("app:plugin-status",x),x=null)}),(t,e)=>(o(),a("div",w,[i.value?(o(),a("iframe",{key:0,src:i.value,class:"fixed inset-0 w-screen h-screen",style:{border:"0"}},null,8,m)):r("",!0)]))}});export{g as default};
